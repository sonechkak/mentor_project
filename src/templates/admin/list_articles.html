{% extends 'base_admin.html' %}
{% load static %}

{% block title %}
<title>Список статей</title>
{% endblock title %}

{% block css %}

{% endblock %}
{% block content %}


<div class="main" >
        <!-- Поиск -->
        <div class="table-container">
            <div class="table-header">
            
                <form method="get" id="searchForm">

                <input type="hidden" placeholder=" Search" name="page_size" value="{{ request.GET.page_size }}">
                <input type="hidden" name="comments_from" value="{{ request.GET.comments_from }}">
                <input type="hidden" name="comments_to" value="{{ request.GET.comments_to }}">
                <input type="hidden" name="views_from" value="{{ request.GET.views_from }}">
                <input type="hidden" name="views_to" value="{{ request.GET.views_to }}">
                <input type="hidden" name="likes_from" value="{{ request.GET.likes_from }}">
                <input type="hidden" name="likes_to" value="{{ request.GET.likes_to }}">
                <input type="hidden" name="dislikes_from" value="{{ request.GET.dislikes_from }}">
                <input type="hidden" name="dislikes_to" value="{{ request.GET.dislikes_to }}">

                    <input type="text" class="search" name="search" placeholder="Search"
                           value="{{ request.GET.search }}">
                </form>
                <div class="pagination-controls">
                        <a class="prev-btn {% if not page_obj.has_previous %}disabled{% endif %}" 
                        {% if page_obj.has_previous %}href="?page={{ page_obj.previous_page_number }}&page_size={{ request.GET.page_size|default:'10' }}&search={{ request.GET.search|default:'' }}&comments_from={{ request.GET.comments_from|default:'' }}&comments_to={{ request.GET.comments_to|default:'' }}&views_from={{ request.GET.views_from|default:'' }}&views_to={{ request.GET.views_to|default:'' }}&likes_from={{ request.GET.likes_from|default:'' }}&likes_to={{ request.GET.likes_to|default:'' }}&dislikes_from={{ request.GET.dislikes_from|default:'' }}&dislikes_to={{ request.GET.dislikes_to|default:'' }}"{% endif %}>
                            ❮
                        </a>
                    
                        <a class="next-btn {% if not page_obj.has_next %}disabled{% endif %}" 
                        {% if page_obj.has_next %}href="?page={{ page_obj.next_page_number }}&page_size={{ request.GET.page_size|default:'10' }}&search={{ request.GET.search|default:'' }}&comments_from={{ request.GET.comments_from|default:'' }}&comments_to={{ request.GET.comments_to|default:'' }}&views_from={{ request.GET.views_from|default:'' }}&views_to={{ request.GET.views_to|default:'' }}&likes_from={{ request.GET.likes_from|default:'' }}&likes_to={{ request.GET.likes_to|default:'' }}&dislikes_from={{ request.GET.dislikes_from|default:'' }}&dislikes_to={{ request.GET.dislikes_to|default:'' }}"{% endif %}>
                            ❯
                        </a>
                        <form method="get" id="pageSizeForm" action="">

                            <input type="hidden" name="search" value="{{ request.GET.search }}">
                            <input type="hidden" name="comments_from" value="{{ request.GET.comments_from }}">
                            <input type="hidden" name="comments_to" value="{{ request.GET.comments_to }}">
                            <input type="hidden" name="views_from" value="{{ request.GET.views_from }}">
                            <input type="hidden" name="views_to" value="{{ request.GET.views_to }}">
                            <input type="hidden" name="likes_from" value="{{ request.GET.likes_from }}">
                            <input type="hidden" name="likes_to" value="{{ request.GET.likes_to }}">
                            <input type="hidden" name="dislikes_from" value="{{ request.GET.dislikes_from }}">
                            <input type="hidden" name="dislikes_to" value="{{ request.GET.dislikes_to }}">

                
                            <label for="page_size"></label>
                            <select class="rows-select" name="page_size" id="page_size" onchange="this.form.submit()">
                                <option value="1" {% if page_size == 1 %}selected{% endif %}>1</option>
                                <option value="10" {% if page_size == 10 %}selected{% endif %}>10</option>
                                <option value="20" {% if page_size == 20 %}selected{% endif %}>20</option>
                                <option value="30" {% if page_size == 30 %}selected{% endif %}>30</option>
                                <option value="40" {% if page_size == 40 %}selected{% endif %}>40</option>

                            </select>
                        </form>
                        <a href="{% url 'admin:create-article' %}" type="button"  class="create-btn">Создать</a>
                </div>
            </div>

                <table class="custom-table">
                    <thead>
                       
                        <tr>
                            <th><input type="checkbox" /></th>
                            <th class="table_row">ID</th>
                            <th class="table_row">Название</th>
                            <th class="table_row">Slug</th>
                            <th class="table_row">Категория</th>
                            <th class="table_row">Автор</th>
                            <th class="table_row">Тэги</th>
                            <th class="table_row"><i class="far fa-eye fa-2x"></i></th>
                            <th class="table_row"><i class="far fa-comment-alt fa-2x"></i></th>
                            <th class="table_row"><i class="far fa-thumbs-up fa-2x" style="color: green"></i></th>
                            <th class="table_row"><i class="far fa-thumbs-down fa-2x" style="color: red"></i></th>
                            <th class="table_row">Дата создания</th>
                            <th class="table_row">Дата публикации</th>
                            <th class="table_row">Черновик</th>
                            <th class="table_row"><i class="fas fa-edit"></i></th>
                            
                        </tr>
                       
                    </thead>
                    <tbody>
                    
                    {% if object_list %}
                        {% for article in object_list %}
            
                         <tr>
                            <td><input type="checkbox" /></td>
                            <td class="table__info_user ">{{ article.pk }}</td>
                            <td class="table__info_user ">{{ article.title }}</td>
                            <td class="table__info_user ">{{ article.slug }}</td>
                            <td class="table__info_user ">{{ article.category }}</td>
                            <td class="table__info_user ">{{ article.author.first_name }} {{ article.author.last_name }}</td>
                            <td class="table__info_user ">{% for tag in article.tags.all %}{{ tag.tag_name }}{% if not forloop.last %}, {% endif %}{% endfor %}</td>
                            <td class="table__info_user ">{{ article.views }}</td>
                            <td class="table__info_user ">{{ article.comments }}</td>
                            <td class="table__info_user ">{{ article.likes }}</td>
                            <td class="table__info_user ">{{ article.dislikes }}</td>
                            <td class="table__info_user ">{{ article.created|date:"d.m.Y" }}</td>
                            <td class="table__info_user ">{{ article.published|date:"d.m.Y" }}</td>
                            {% if article.is_draft %}
                            <td class="table__info_user "><input type="checkbox" checked=""></td>
                            {% else %}
                            <td class="table__info_user "><input type="checkbox"></td>
                            {% endif %}
                            <td>
                                <a href="{% url 'admin:edit-article' slug=article.slug %}"><img src="{% static 'img/pen.svg' %}" alt="" class="pen" /></a></td>
{#                            <td><a href="{% url 'admin:edit_article' slug=article.slug %}"><img src="{% static 'img/pen.svg' %}" alt="" class="pen" /></a></td>#}
                        {% endfor %}
                    {% else %}
                            <tr>
                                <td colspan="15" style="text-align: center">Список пуст</td>
                            </tr>
                        {% endif %}
                         
                        
                    </tbody>
                </table>
            </div>

        <!-- Новый контейнер для блока фильтрации -->
        <div class="filter-container">
            <div class="filter">
                <h3 class="text-center">Фильтрация</h3>
                <form method="get" id="filterForm">

                    <input type="hidden" name="search" value="{{ request.GET.search }}">
                    <input type="hidden" name="page_size" value="{{ request.GET.page_size }}">

                    <label for="number_comments">Комментариев от и до:</label>
                    <input type="text" id="comments_from" name="comments_from"
                           value="{{ request.GET.comments_from }}">
                    <input type="text" id="comments_to" name="comments_to"
                           value="{{ request.GET.comments_to }}">
                    <label for="number_views">Просмотров от и до:</label>
                    <input type="number" id="views_from" name="views_from"
                           value="{{ request.GET.views_from }}">
                    <input type="number" id="views_to" name="views_to"
                           value="{{ request.GET.views_to }}">
                    <label for="number_likes">Лайков от и до:</label>
                    <input type="number" id="likes_from" name="likes_from"
                           value="{{ request.GET.likes_from }}">
                    <input type="number" id="likes_to" name="likes_to"
                           value="{{ request.GET.likes_to }}">
                    <label for="number_dislikes">Дизлайков от и до:</label>
                    <input type="number" id="dislikes_from" name="dislikes_from"
                           value="{{ request.GET.dislikes_from }}">
                    <input type="number" id="dislikes_to" name="dislikes_to"
                           value="{{ request.GET.dislikes_to }}">

                    <button type="submit" class="btn my-2" id="filter-btn">Применить фильтр</button>
                    <a class="btn container-fluid" type="button" href="{% url 'admin:list_articles' %}">Очистить
                        фильтр</a>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock content %}
