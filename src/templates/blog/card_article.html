{% load static %}
{% load custom_tags %}

<!-- Custom CSS -->
{% block styles %}
<link rel="stylesheet" href="{% static 'css/blog/card_article.css' %}">
{% endblock styles %}

<!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ—Å—Ç–∞ -->
<a href="{% url 'blog:article_detail' slug=article.slug %}" class="text-decoration-none">
<div class="article-card no-bootstrap">
    <!-- –ü–æ–ª–æ—Å–∞ —Å–ª–µ–≤–∞ -->
    <div class="article-card__stripe"></div>

    <div class="article-card__content-wrapper">
        <!-- –î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ -->
        <p class="article-card__publish-date">{{ article.published|date:"d.m.Y" }}</p>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—å–∏ -->
        <h2 class="article-card__title">

                {{ article.title }}

        </h2>

        <!-- –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏ -->
        <div class="article-card__text">
            {{ article.content_html|safe }}
        </div>

        <!-- –¢–µ–≥–∏ —Å—Ç–∞—Ç—å–∏ -->
        <div class="article-card__tags">
            {% for tag_relation in article.articletag_set.all %}
                {% with rgb=tag_relation.tag.color|hex_to_rgb %}
                    <span class="article-card__tag" style="background-color: rgba({{ rgb.0 }}, {{ rgb.1 }}, {{ rgb.2 }}, 0.15); color: {{ tag_relation.tag.color }};">
                        {{ tag_relation.tag.tag_name }}
                    </span>
                {% endwith %}

            {% endfor %}
        </div>
    </div>

    <!-- –§—É—Ç–µ—Ä –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –∞–≤—Ç–æ—Ä–µ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π -->
    <div class="article-card__footer">
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≤—Ç–æ—Ä–µ -->
        <div class="article-card__author">
            {% if article.author.avatar %}
                <img src="{{ article.author.avatar.url }}" alt="{{ article.author.first_name }}" class="article-card__author-avatar">
            {% else %}
                <img src="{% static 'img/user.png' %}" alt="Default Avatar" class="article-card__author-avatar">
            {% endif %}
            <span class="article-card__author-name">{{ article.author.first_name }}</span>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="article-card__stats">
            <span class="article-card__comments">üí¨ {{ article.comment.all.count }}</span>
            <span class="article-card__views">
                üëÅ
                {{ article.views }}
            </span>
        </div>
    </div>

    <!-- –ò–∫–æ–Ω–∫–∞ —Ç–µ–≥–∞ -->
    {% with first_tag=article.articletag_set.first %}
    {% if first_tag and first_tag.tag.icon %} <!-- –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∏–∫–æ–Ω–∫–∏ —É –ø–µ—Ä–≤–æ–≥–æ —Ç–µ–≥–∞ -->
        <div class="article-card__tag-icon">
            <img src="{{ first_tag.tag.icon.url }}" alt="Tag Icon">
        </div>
    {% endif %}
    {% endwith %}
</div>
</a>